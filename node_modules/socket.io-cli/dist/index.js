#!/usr/bin/env node
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var arg_1 = __importDefault(require("arg"));
var path_1 = __importDefault(require("path"));
var socket_io_client_1 = __importDefault(require("socket.io-client"));
var help_1 = __importDefault(require("./help"));
var prompt_1 = __importDefault(require("./prompt"));
var App = /** @class */ (function () {
    function App() {
        this.prompt = new prompt_1.default(this);
    }
    App.prototype.start = function () {
        var _this = this;
        var config = (0, arg_1.default)({
            '--help': Boolean,
            '--version': Boolean,
            '-h': '--help',
            '-v': '--version'
        });
        if (config['--version']) {
            console.log("v" + require(path_1.default.join(__dirname, '../package.json')).version);
            process.exit(0);
        }
        if (config['--help'])
            return (0, help_1.default)();
        if (config._.length !== 1)
            return (0, help_1.default)();
        this.socket = (0, socket_io_client_1.default)(config._[0]);
        this.socket.on('connect', function () {
            console.log("Connected to " + config._[0]);
            _this.prompt.ask();
        });
        this.socket.on('connect_error', function (err) { return console.log('Connection error: ', err); });
        this.socket.on('disconnect', function (reason) { return console.log("Disconnected from " + config._[0] + ": " + reason); });
        this.socket.onAny(function (event) {
            var _a, _b, _c, _d;
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            var input = (_b = (_a = _this.prompt.rl) === null || _a === void 0 ? void 0 : _a.line) !== null && _b !== void 0 ? _b : '';
            (_c = _this.prompt.rl) === null || _c === void 0 ? void 0 : _c.close();
            console.log("\r" + event + " " + JSON.stringify(args));
            _this.prompt.ask();
            (_d = _this.prompt.rl) === null || _d === void 0 ? void 0 : _d.write(input);
        });
    };
    return App;
}());
exports.default = App;
